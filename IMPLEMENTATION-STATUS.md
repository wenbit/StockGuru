# ğŸš€ StockGuru å®ç°çŠ¶æ€

## å½“å‰å®ç°æƒ…å†µ

### âœ… å·²å®ç°ï¼šçœŸå®æ•°æ®æ¥å£

**ç°åœ¨è°ƒç”¨çš„æ˜¯çœŸå®æ¥å£ï¼** å·²ç»é›†æˆäº†ç°æœ‰çš„ç­›é€‰é€»è¾‘æ¨¡å—ã€‚

---

## ğŸ“Š æ•°æ®æµç¨‹

### 1. å‰ç«¯å‘èµ·è¯·æ±‚
```typescript
// frontend/app/page.tsx
const response = await apiClient.createScreening({
  date: '2025-10-14',
});
```

### 2. åç«¯å¤„ç†æµç¨‹
```
API è·¯ç”± (screening.py)
    â†“
ç­›é€‰æœåŠ¡ (screening_service.py)
    â†“
â”œâ”€ åˆ›å»ºä»»åŠ¡è®°å½• â†’ Supabase tasks è¡¨
â”œâ”€ è·å–æˆäº¤é‡æ•°æ® â†’ DataFetcher
â”œâ”€ è·å–çƒ­åº¦æ•°æ® â†’ DataFetcher
â”œâ”€ ç­›é€‰è‚¡ç¥¨ â†’ StockFilter
â”œâ”€ è®¡ç®—åŠ¨é‡ â†’ MomentumCalculator
â””â”€ ä¿å­˜ç»“æœ â†’ Supabase results è¡¨
```

### 3. æ•°æ®æ¥æº

**çœŸå®æ•°æ®æº**:
- âœ… **pywencai** - é—®è´¢æ•°æ®ï¼ˆæˆäº¤é‡ã€çƒ­åº¦æ’åï¼‰
- âœ… **akshare** - AkShare æ•°æ®ï¼ˆKçº¿æ•°æ®ï¼‰
- âœ… **Supabase** - æ•°æ®æŒä¹…åŒ–

---

## ğŸ”§ æ ¸å¿ƒæ¨¡å—

### 1. æ•°æ®è·å– (`data_fetcher.py`)
```python
class DataFetcher:
    def fetch_volume_ranking(date, top_n)  # è·å–æˆäº¤é‡æ’å
    def fetch_hot_ranking(date, top_n)     # è·å–çƒ­åº¦æ’å
    def fetch_kline_data(code, date)       # è·å–Kçº¿æ•°æ®
```

### 2. è‚¡ç¥¨ç­›é€‰ (`stock_filter.py`)
```python
class StockFilter:
    def filter_stocks(volume_data, hot_data)  # ç­›é€‰è‚¡ç¥¨
    def calculate_comprehensive_score()        # è®¡ç®—ç»¼åˆè¯„åˆ†
```

### 3. åŠ¨é‡è®¡ç®— (`momentum_calculator.py`)
```python
class MomentumCalculator:
    def calculate_momentum(stocks, date)  # è®¡ç®—åŠ¨é‡åˆ†æ•°
    def rank_by_momentum()                # æŒ‰åŠ¨é‡æ’åº
```

### 4. ç­›é€‰æœåŠ¡ (`screening_service.py`) âœ¨ æ–°å¢
```python
class ScreeningService:
    async def create_screening_task()  # åˆ›å»ºç­›é€‰ä»»åŠ¡
    async def get_task_result()        # è·å–ä»»åŠ¡ç»“æœ
    async def list_tasks()             # è·å–ä»»åŠ¡åˆ—è¡¨
```

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
stockguru-web/backend/app/
â”œâ”€â”€ api/
â”‚   â””â”€â”€ screening.py          # âœ… å·²æ›´æ–° - è°ƒç”¨çœŸå®æœåŠ¡
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ screening_service.py  # âœ… æ–°å¢ - ç­›é€‰æœåŠ¡
â”‚   â””â”€â”€ modules/              # âœ… ç°æœ‰æ¨¡å—
â”‚       â”œâ”€â”€ data_fetcher.py
â”‚       â”œâ”€â”€ stock_filter.py
â”‚       â”œâ”€â”€ momentum_calculator.py
â”‚       â””â”€â”€ report_generator.py
â””â”€â”€ core/
    â”œâ”€â”€ config.py
    â””â”€â”€ supabase.py
```

---

## ğŸ¯ åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ | ä¹‹å‰ | ç°åœ¨ |
|------|------|------|
| æ•°æ®æ¥æº | âŒ æ¨¡æ‹Ÿæ•°æ® | âœ… çœŸå® API |
| æˆäº¤é‡æ’å | âŒ ç¡¬ç¼–ç  | âœ… pywencai |
| çƒ­åº¦æ’å | âŒ ç¡¬ç¼–ç  | âœ… pywencai |
| Kçº¿æ•°æ® | âŒ æ—  | âœ… akshare |
| åŠ¨é‡è®¡ç®— | âŒ æ—  | âœ… çœŸå®è®¡ç®— |
| æ•°æ®æŒä¹…åŒ– | âŒ æ—  | âœ… Supabase |
| ä»»åŠ¡ç®¡ç† | âŒ æ—  | âœ… å®Œæ•´æµç¨‹ |

---

## ğŸ”„ å®Œæ•´æ‰§è¡Œæµç¨‹

### ç”¨æˆ·ç‚¹å‡»"ä¸€é”®ç­›é€‰"åï¼š

1. **åˆ›å»ºä»»åŠ¡** (0%)
   - ç”Ÿæˆ UUID
   - ä¿å­˜åˆ° `tasks` è¡¨
   - çŠ¶æ€: `pending`

2. **è·å–æˆäº¤é‡æ•°æ®** (10-30%)
   - è°ƒç”¨ pywencai API
   - è·å–å‰100åªæˆäº¤é‡æœ€å¤§çš„è‚¡ç¥¨
   - çŠ¶æ€: `running`

3. **è·å–çƒ­åº¦æ•°æ®** (30-50%)
   - è°ƒç”¨ pywencai API
   - è·å–å‰100åªçƒ­åº¦æœ€é«˜çš„è‚¡ç¥¨

4. **ç­›é€‰è‚¡ç¥¨** (50-70%)
   - å–æˆäº¤é‡å’Œçƒ­åº¦çš„äº¤é›†
   - è¿‡æ»¤ ST è‚¡ç¥¨
   - è®¡ç®—ç»¼åˆè¯„åˆ†

5. **è®¡ç®—åŠ¨é‡** (70-90%)
   - è·å–æ¯åªè‚¡ç¥¨çš„Kçº¿æ•°æ®
   - è®¡ç®—25æ—¥åŠ¨é‡åˆ†æ•°
   - æŒ‰åŠ¨é‡æ’åº

6. **ä¿å­˜ç»“æœ** (90-100%)
   - ä¿å­˜å‰30åªè‚¡ç¥¨åˆ° `results` è¡¨
   - æ›´æ–°ä»»åŠ¡çŠ¶æ€: `completed`
   - è®°å½•ç»“æœæ•°é‡

---

## âš ï¸ é‡è¦è¯´æ˜

### æ•°æ®æºä¾èµ–

1. **pywencai**
   - éœ€è¦ç½‘ç»œè¿æ¥
   - å¯èƒ½éœ€è¦ç™»å½•/éªŒè¯
   - æœ‰è®¿é—®é¢‘ç‡é™åˆ¶

2. **akshare**
   - å…è´¹å¼€æºæ•°æ®
   - å®æ—¶æ›´æ–°
   - æ— éœ€è®¤è¯

### é¦–æ¬¡è¿è¡Œå¯èƒ½é‡åˆ°çš„é—®é¢˜

```bash
# 1. æ£€æŸ¥ä¾èµ–æ˜¯å¦å®‰è£…
cd stockguru-web/backend
source venv/bin/activate
pip list | grep -E "pywencai|akshare"

# 2. æµ‹è¯•æ•°æ®è·å–
python -c "import pywencai; print('pywencai OK')"
python -c "import akshare; print('akshare OK')"

# 3. æŸ¥çœ‹æ—¥å¿—
tail -f backend.log
```

---

## ğŸ§ª æµ‹è¯•çœŸå®æ¥å£

### 1. é‡å¯åç«¯æœåŠ¡

```bash
# åœæ­¢å½“å‰æœåŠ¡
./stop-all.sh

# é‡æ–°å¯åŠ¨
./start-all.sh
```

### 2. æµ‹è¯•ç­›é€‰

è®¿é—® http://localhost:3000ï¼Œç‚¹å‡»"ä¸€é”®ç­›é€‰"

**é¢„æœŸç»“æœ**:
- æ˜¾ç¤º"ç­›é€‰ä¸­..."
- åç«¯å¼€å§‹è·å–çœŸå®æ•°æ®
- çº¦1-2åˆ†é’Ÿåå®Œæˆ
- æ˜¾ç¤º"âœ… ä»»åŠ¡åˆ›å»ºæˆåŠŸ"

### 3. æŸ¥çœ‹æ•°æ®åº“

è®¿é—® Supabase Dashboard:
- `tasks` è¡¨ï¼šæŸ¥çœ‹ä»»åŠ¡è®°å½•
- `results` è¡¨ï¼šæŸ¥çœ‹ç­›é€‰ç»“æœ

---

## ğŸ“ ä¸‹ä¸€æ­¥ä¼˜åŒ–

### çŸ­æœŸï¼ˆå¿…é¡»ï¼‰
- [ ] æ·»åŠ é”™è¯¯é‡è¯•æœºåˆ¶
- [ ] ä¼˜åŒ–æ•°æ®è·å–æ€§èƒ½
- [ ] æ·»åŠ è¿›åº¦å®æ—¶æ¨é€
- [ ] å®Œå–„é”™è¯¯å¤„ç†

### ä¸­æœŸï¼ˆé‡è¦ï¼‰
- [ ] æ·»åŠ æ•°æ®ç¼“å­˜
- [ ] å®ç°åå°ä»»åŠ¡é˜Ÿåˆ—
- [ ] æ·»åŠ ç»“æœå±•ç¤ºé¡µé¢
- [ ] å®ç°å†å²è®°å½•æŸ¥è¯¢

### é•¿æœŸï¼ˆä¼˜åŒ–ï¼‰
- [ ] æ·»åŠ è‡ªå®šä¹‰ç­›é€‰å‚æ•°
- [ ] å®ç°Kçº¿å›¾è¡¨å±•ç¤º
- [ ] æ·»åŠ è‚¡ç¥¨è¯¦æƒ…é¡µ
- [ ] å®ç°æ•°æ®å¯¼å‡ºåŠŸèƒ½

---

## ğŸ‰ æ€»ç»“

**ç°åœ¨æ˜¯çœŸå®æ•°æ®ï¼** 

- âœ… é›†æˆäº†ç°æœ‰çš„ç­›é€‰é€»è¾‘
- âœ… è°ƒç”¨çœŸå®çš„æ•°æ®æº API
- âœ… å®Œæ•´çš„ä»»åŠ¡ç®¡ç†æµç¨‹
- âœ… æ•°æ®æŒä¹…åŒ–åˆ° Supabase

**é‡å¯æœåŠ¡åå³å¯ä½¿ç”¨çœŸå®æ•°æ®è¿›è¡Œç­›é€‰ï¼**
