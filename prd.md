### **股票短线复盘助手 - 产品需求文档 (PRD)**

| **文档版本** | **V1.1** | **创建日期** | 2025年10月14日 |
| :--- | :--- | :--- | :--- |
| **创建人** | Cascade | **最后更新** | 2025年10月15日 |
| **当前版本** | v0.5 (基础功能) | **目标版本** | v1.0 (完整产品) |
| **完成度** | 67% | **预计完成** | 2025年11月15日 |

### 1. 项目概述

#### 1.1 项目背景
短线交易者在每日复盘时，面临从数千只股票中筛选出具备潜力的强势股的挑战。手动筛选和逐一查看行情软件的过程繁琐、耗时且效率低下。本项目旨在开发一款自动化工具，通过量化模型筛选出市场中的强势股，并生成一份简洁的可视化报告，从而极大地提升复盘效率。

#### 1.2 项目目标
- **核心目标**：自动化筛选每日的强势股，并提供一站式的可视化复盘报告。
- **效率目标**：将数小时的复盘工作缩短至几分钟内完成。
- **技术目标**：使用 Python + Web 技术栈实现。

#### 1.3 用户画像
- 关注短线交易和技术分析的个人投资者。
- 希望通过量化手段提高选股和复盘效率的股民。

#### 1.4 当前实现状态 (v0.5)
**已完成功能**:
- ✅ Web 界面 (Next.js + TypeScript)
- ✅ 后端 API (FastAPI + Python 3.12)
- ✅ 筛选算法框架
- ✅ 后台任务处理
- ✅ 实时进度显示
- ✅ 结果表格展示

**当前限制**:
- ⚠️ 使用模拟数据（未集成真实 API）
- ⚠️ 无 K线图表展示
- ⚠️ 数据持久化待修复

**技术栈**:
- 前端: Next.js 14 + TypeScript + Tailwind CSS
- 后端: FastAPI + Python 3.12
- 数据库: Supabase (PostgreSQL)
- 数据源: pywencai + akshare (待集成)

### 2. 功能需求 (Features)

#### 2.1 核心功能：强势股筛选模型
此功能是工具的数据核心，负责从全市场股票中筛选出最终的候选股池。

- **F-01：数据获取** 🔴 高优先级
    - **需求描述**：程序需要能够获取全市场股票的行情和热度数据。
    - **数据源**：参考文章建议使用 `pywencai` 库。
    - **具体实现**：
        - 获取指定交易日**成交额排名前 100** 的股票列表。
        - 获取指定交易日**个股热度排名前 100** 的股票列表。
    - **实现状态**：
        - ✅ 代码框架已完成 (`data_fetcher.py`)
        - ❌ 当前使用模拟数据
        - 🎯 待集成真实 pywencai API
        - ⏱️ 预计工作量：4-6 小时

- **F-02：综合评分与初选** ✅ 已完成
    - **需求描述**：对获取到的数据进行处理，筛选出兼具“资金”和“人气”的股票。
    - **具体实现**：
        - 取成交额Top100和热度Top100两个股票池的**交集**。
        - 对交集内股票的成交额和热度数据进行**Min-Max标准化**处理。
        - 计算**综合评分**（例如：`综合分 = 0.5 * 标准化成交额 + 0.5 * 标准化热度`）。
        - 根据综合评分从高到低排序，筛选出**排名前 30** 的股票作为初选池。
    - **实现状态**：
        - ✅ 算法已完整实现 (`stock_filter.py`)
        - ✅ Min-Max 标准化完成
        - ✅ 综合评分计算完成
        - ✅ 排序和筛选完成

- **F-03：动量评分与终选** 🔴 高优先级
    - **需求描述**：对初选池中的股票进行技术面分析，选出趋势最强的股票。
    - **具体实现**：
        - 对初选池中的每只股票，计算其过去 **25 天**的**动量得分**。
        - **动量算法**：基于价格进行线性回归，`动量分 = 回归斜率 * R²`。这可以有效衡量趋势的强度和稳定性。
        - 根据动量分从高到低排序，筛选出**排名前 10** 的股票作为最终的强势股池。
    - **实现状态**：
        - ✅ 算法已完整实现 (`momentum_calculator.py`)
        - ❌ 当前使用模拟 K线数据
        - 🎯 待集成真实 akshare K线数据
        - ⏱️ 预计工作量：2-3 小时

- **F-04：参数可配置** ✅ 已完成
    - **需求描述**：筛选过程中的关键参数应支持用户自定义修改，以适应不同的市场风格和个人偏好。
    - **可配置参数**：
        - `VOLUME_TOP_N` (成交额排名范围，默认100)
        - `HOT_TOP_N` (热度排名范围，默认100)
        - `FINAL_TOP_N` (综合评分排名范围，默认30)
        - `MOMENTUM_DAYS` (动量计算周期，默认25天)
        - `MOMENTUM_TOP_N` (最终筛选数量，默认10)
    - **实现状态**：
        - ✅ 所有参数均可配置
        - ✅ 在代码中定义为常量
        - ✅ 可通过 API 参数传递

#### 2.2 核心功能：可视化复盘报告
此功能负责将筛选结果以清晰、直观的方式呈现给用户。

- **F-05：生成可视化报告** 🟡 中优先级
    - **需求描述**：基于最终筛选出的10只强势股，生成可视化报告。
    - **技术选型**：Web 界面 (Next.js) + 图表库 (ECharts/Recharts)
    - **页面布局**：
        - 页面顶部显示报告生成日期。
        - 股票列表按动量分从高到低垂直排列。
        - 每个股票占据一个卡片区域，方便滚动浏览。
    - **实现状态**：
        - ✅ Web 界面表格展示
        - ✅ 基础信息展示（代码、名称、分数）
        - ❌ 缺少 K线图表
        - 🎯 待添加图表组件
        - ⏱️ 预计工作量：4-6 小时

- **F-06：个股信息展示** 🟡 中优先级
    - **需求描述**：在每个股票卡片中，展示详细的复盘信息。
    - **展示内容**：
        - **基础信息**：股票代码、股票名称。
        - **核心指标**：最终的动量得分。
        - **可视化图表**：该股票的 **K线图**（包含均线，如MA5, MA10, MA20）。
    - **实现状态**：
        - ✅ 基础信息展示
        - ✅ 核心指标展示（动量分、综合分、涨跌幅）
        - ❌ 缺少 K线图表
        - 🎯 待创建股票详情页
        - ⏱️ 预计工作量：4-5 小时

#### 2.3 扩展功能：Web 版新增

- **F-07：数据持久化** 🔴 高优先级
    - **需求描述**：将筛选任务和结果保存到数据库。
    - **具体实现**：
        - 任务记录表 (tasks)
        - 筛选结果表 (results)
        - 历史记录查询
    - **实现状态**：
        - ✅ 数据库表结构设计完成
        - ✅ API 接口已实现
        - ❌ Supabase 连接待修复
        - ⚠️ 当前使用内存存储
        - ⏱️ 预计工作量：1-2 小时

- **F-08：历史记录功能** 🟡 中优先级
    - **需求描述**：查看和对比历史筛选记录。
    - **具体实现**：
        - 历史任务列表
        - 结果详情查看
        - 不同日期对比
    - **实现状态**：
        - ✅ 后端 API 已实现
        - ❌ 前端页面待开发
        - ⏱️ 预计工作量：3-4 小时

- **F-09：实时进度显示** ✅ 已完成
    - **需求描述**：显示筛选任务的实时进度。
    - **实现状态**：
        - ✅ 后台任务处理
        - ✅ 进度追踪 (0-100%)
        - ✅ 前端轮询机制
        - ✅ 进度条可视化

### 3. 非功能性需求

- **性能**：数据获取和计算过程应在2分钟内完成。
    - **当前状态**：模拟数据约 8 秒，真实数据性能待测试
    - **优化计划**：并发数据获取、数据缓存
    
- **易用性**：提供简单的命令行接口或图形界面来触发执行。
    - **当前状态**：✅ Web 图形界面已完成，CLI 工具待开发
    
- **扩展性**：代码结构应清晰，方便未来增加新的选股因子或修改算法。
    - **当前状态**：✅ 模块化设计，职责分离清晰

### 4. 版本规划与开发路线图

#### 4.1 版本规划

**v0.5 - 基础版本** ✅ (当前)
- 发布时间：2025-10-14
- 完成度：67%
- 主要功能：Web 界面、筛选算法框架、后台任务处理

**v0.8 - 数据版本** 🎯 (下一个)
- 预计发布：2025-10-22 (1周后)
- 目标完成度：85%
- 核心目标：
  - 🔴 集成真实数据源 (pywencai + akshare)
  - 🔴 修复 Supabase 连接
  - 🔴 真实动量计算

**v0.9 - 可视化版本** 📈
- 预计发布：2025-10-29 (2周后)
- 目标完成度：95%
- 核心目标：
  - 🟡 K线图表展示
  - 🟡 股票详情页
  - 🟡 历史记录功能

**v1.0 - 完整版本** 🎉
- 预计发布：2025-11-15 (1个月后)
- 目标完成度：100%
- 核心目标：
  - 🟢 功能完善
  - 🟢 性能优化
  - 🟢 用户体验提升

#### 4.2 开发优先级

**🔴 高优先级（必须完成）**
1. F-01: 真实数据源集成 (4-6 小时)
2. F-03: 真实动量计算 (2-3 小时)
3. F-07: Supabase 连接修复 (1-2 小时)

**🟡 中优先级（重要但不紧急）**
4. F-05: K线图表展示 (4-6 小时)
5. F-06: 股票详情页 (4-5 小时)
6. F-08: 历史记录功能 (3-4 小时)

**🟢 低优先级（锦上添花）**
7. HTML 报告导出 (3-4 小时)
8. 命令行工具 (2-3 小时)
9. 性能优化 (2-3 小时)

#### 4.3 预计工作量

| 阶段 | 任务数 | 预计时间 | 完成后功能 |
|------|--------|----------|-----------|
| 第一阶段 (v0.8) | 3 | 1-2 周 | 真实数据筛选 |
| 第二阶段 (v0.9) | 3 | 1-2 周 | 完整可视化 |
| 第三阶段 (v1.0) | 4 | 2-3 周 | 功能完善 |
| **总计** | **10** | **4-7 周** | **完整产品** |

### 5. 相关文档

- **TODO.md** - 详细待办清单
- **ROADMAP.md** - 开发路线图
- **PROJECT-SUMMARY.md** - 项目总结
- **FEATURE-UPDATE.md** - 功能更新说明
- **docs/开发故事-短线助手开发记录.md** - 项目灵感来源

---

**文档更新日期**: 2025-10-15  
**下次更新**: v0.8 发布后
