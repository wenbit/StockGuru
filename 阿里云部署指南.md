# StockGuru é˜¿é‡Œäº‘éƒ¨ç½²æŒ‡å—

**ç‰ˆæœ¬**: v1.0  
**æ›´æ–°æ—¶é—´**: 2025-10-15

---

## ğŸ“‹ ç›®å½•

1. [éƒ¨ç½²æ–¹æ¡ˆé€‰æ‹©](#éƒ¨ç½²æ–¹æ¡ˆé€‰æ‹©)
2. [æ–¹æ¡ˆ1: ECS äº‘æœåŠ¡å™¨éƒ¨ç½²](#æ–¹æ¡ˆ1-ecs-äº‘æœåŠ¡å™¨éƒ¨ç½²)
3. [æ–¹æ¡ˆ2: å‡½æ•°è®¡ç®— + OSS éƒ¨ç½²](#æ–¹æ¡ˆ2-å‡½æ•°è®¡ç®—--oss-éƒ¨ç½²)
4. [æ–¹æ¡ˆ3: å®¹å™¨æœåŠ¡ ACK éƒ¨ç½²](#æ–¹æ¡ˆ3-å®¹å™¨æœåŠ¡-ack-éƒ¨ç½²)
5. [åŸŸåå’Œ SSL é…ç½®](#åŸŸåå’Œ-ssl-é…ç½®)
6. [ç›‘æ§å’Œè¿ç»´](#ç›‘æ§å’Œè¿ç»´)

---

## éƒ¨ç½²æ–¹æ¡ˆé€‰æ‹©

### æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | æˆæœ¬ | éš¾åº¦ | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| **ECS äº‘æœåŠ¡å™¨** | Â¥100-300/æœˆ | â­â­ | å®Œå…¨æ§åˆ¶ï¼Œé€‚åˆé•¿æœŸè¿è¡Œ |
| **å‡½æ•°è®¡ç®— + OSS** | Â¥10-50/æœˆ | â­â­â­ | æŒ‰é‡ä»˜è´¹ï¼Œé€‚åˆä½æµé‡ |
| **å®¹å™¨æœåŠ¡ ACK** | Â¥200-500/æœˆ | â­â­â­â­ | é«˜å¯ç”¨ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒ |

**æ¨è**: ä¸ªäººé¡¹ç›®æˆ–å°å›¢é˜Ÿä½¿ç”¨ **ECS äº‘æœåŠ¡å™¨**ï¼Œæ€§ä»·æ¯”æœ€é«˜ã€‚

---

## æ–¹æ¡ˆ1: ECS äº‘æœåŠ¡å™¨éƒ¨ç½²

### 1.1 è´­ä¹° ECS å®ä¾‹

1. **ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å°**
   - è®¿é—® https://ecs.console.aliyun.com

2. **åˆ›å»ºå®ä¾‹**
   - åœ°åŸŸ: é€‰æ‹©ç¦»ç”¨æˆ·è¿‘çš„ï¼ˆå¦‚åä¸œ2-ä¸Šæµ·ï¼‰
   - å®ä¾‹è§„æ ¼: 
     - å…¥é—¨: `ecs.t6-c1m1.large` (1æ ¸2G) - Â¥60/æœˆ
     - æ¨è: `ecs.t6-c1m2.large` (1æ ¸4G) - Â¥100/æœˆ
   - é•œåƒ: Ubuntu 22.04 64ä½
   - å­˜å‚¨: 40GB é«˜æ•ˆäº‘ç›˜
   - ç½‘ç»œ: æŒ‰ä½¿ç”¨æµé‡è®¡è´¹ï¼ˆ1-5Mbpsï¼‰

3. **å®‰å…¨ç»„é…ç½®**
   - å¼€æ”¾ç«¯å£: 22 (SSH), 80 (HTTP), 443 (HTTPS), 8000 (API)

### 1.2 è¿æ¥æœåŠ¡å™¨

```bash
# ä½¿ç”¨ SSH è¿æ¥
ssh root@your-server-ip

# é¦–æ¬¡ç™»å½•åï¼Œåˆ›å»ºæ–°ç”¨æˆ·ï¼ˆå®‰å…¨è€ƒè™‘ï¼‰
adduser stockguru
usermod -aG sudo stockguru
su - stockguru
```

### 1.3 å®‰è£…åŸºç¡€ç¯å¢ƒ

```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£… Node.js 18
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# å®‰è£… Python 3.10+
sudo apt install -y python3 python3-pip python3-venv

# å®‰è£… Nginx
sudo apt install -y nginx

# å®‰è£… Git
sudo apt install -y git

# éªŒè¯å®‰è£…
node --version
python3 --version
nginx -v
```

### 1.4 å…‹éš†é¡¹ç›®

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir -p ~/apps
cd ~/apps

# å…‹éš†é¡¹ç›®
git clone https://github.com/wenbit/StockGuru.git
cd StockGuru
```

### 1.5 éƒ¨ç½²åç«¯

```bash
# è¿›å…¥åç«¯ç›®å½•
cd ~/apps/StockGuru/stockguru-web/backend

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
nano .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š
```env
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_KEY=your-anon-key
FRONTEND_URL=https://your-domain.com
API_HOST=0.0.0.0
API_PORT=8000
LOG_LEVEL=INFO
```

```bash
# æµ‹è¯•è¿è¡Œ
uvicorn app.main:app --host 0.0.0.0 --port 8000

# è®¿é—®æµ‹è¯•
curl http://localhost:8000/health
```

### 1.6 ä½¿ç”¨ Systemd ç®¡ç†åç«¯æœåŠ¡

åˆ›å»ºæœåŠ¡æ–‡ä»¶ï¼š

```bash
sudo nano /etc/systemd/system/stockguru-backend.service
```

å†…å®¹ï¼š
```ini
[Unit]
Description=StockGuru Backend API
After=network.target

[Service]
Type=simple
User=stockguru
WorkingDirectory=/home/stockguru/apps/StockGuru/stockguru-web/backend
Environment="PATH=/home/stockguru/apps/StockGuru/stockguru-web/backend/venv/bin"
ExecStart=/home/stockguru/apps/StockGuru/stockguru-web/backend/venv/bin/uvicorn app.main:app --host 0.0.0.0 --port 8000
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

å¯åŠ¨æœåŠ¡ï¼š
```bash
# é‡è½½é…ç½®
sudo systemctl daemon-reload

# å¯åŠ¨æœåŠ¡
sudo systemctl start stockguru-backend

# è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl enable stockguru-backend

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status stockguru-backend

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u stockguru-backend -f
```

### 1.7 éƒ¨ç½²å‰ç«¯

```bash
# è¿›å…¥å‰ç«¯ç›®å½•
cd ~/apps/StockGuru/frontend

# å®‰è£…ä¾èµ–
npm install

# é…ç½®ç¯å¢ƒå˜é‡
nano .env.local
```

å†…å®¹ï¼š
```env
NEXT_PUBLIC_API_URL=https://api.your-domain.com
```

```bash
# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# å®‰è£… PM2
sudo npm install -g pm2

# å¯åŠ¨å‰ç«¯
pm2 start npm --name "stockguru-frontend" -- start

# ä¿å­˜ PM2 é…ç½®
pm2 save

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
# å¤åˆ¶è¾“å‡ºçš„å‘½ä»¤å¹¶æ‰§è¡Œ

# æŸ¥çœ‹çŠ¶æ€
pm2 status
pm2 logs stockguru-frontend
```

### 1.8 é…ç½® Nginx åå‘ä»£ç†

```bash
# åˆ›å»ºé…ç½®æ–‡ä»¶
sudo nano /etc/nginx/sites-available/stockguru
```

å†…å®¹ï¼š
```nginx
# å‰ç«¯æœåŠ¡
server {
    listen 80;
    server_name your-domain.com www.your-domain.com;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_cache_bypass $http_upgrade;
    }
}

# åç«¯ API
server {
    listen 80;
    server_name api.your-domain.com;

    location / {
        proxy_pass http://localhost:8000;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        
        # CORS é…ç½®
        add_header Access-Control-Allow-Origin *;
        add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS';
        add_header Access-Control-Allow-Headers 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range';
    }
}
```

å¯ç”¨é…ç½®ï¼š
```bash
# åˆ›å»ºè½¯é“¾æ¥
sudo ln -s /etc/nginx/sites-available/stockguru /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯ Nginx
sudo systemctl restart nginx

# è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl enable nginx
```

### 1.9 é…ç½®é˜²ç«å¢™

```bash
# å®‰è£… UFW
sudo apt install -y ufw

# å…è®¸å¿…è¦ç«¯å£
sudo ufw allow 22/tcp    # SSH
sudo ufw allow 80/tcp    # HTTP
sudo ufw allow 443/tcp   # HTTPS

# å¯ç”¨é˜²ç«å¢™
sudo ufw enable

# æŸ¥çœ‹çŠ¶æ€
sudo ufw status
```

---

## æ–¹æ¡ˆ2: å‡½æ•°è®¡ç®— + OSS éƒ¨ç½²

### 2.1 éƒ¨ç½²å‰ç«¯åˆ° OSS

1. **åˆ›å»º OSS å­˜å‚¨æ¡¶**
   - è®¿é—® https://oss.console.aliyun.com
   - åˆ›å»º Bucket: `stockguru-web`
   - åŒºåŸŸ: åä¸œ2ï¼ˆä¸Šæµ·ï¼‰
   - è¯»å†™æƒé™: å…¬å…±è¯»

2. **æ„å»ºå‰ç«¯**
   ```bash
   cd frontend
   npm run build
   npm run export  # å¯¼å‡ºé™æ€æ–‡ä»¶åˆ° out ç›®å½•
   ```

3. **ä¸Šä¼ åˆ° OSS**
   ```bash
   # å®‰è£… ossutil
   wget http://gosspublic.alicdn.com/ossutil/1.7.15/ossutil64
   chmod 755 ossutil64
   
   # é…ç½®
   ./ossutil64 config
   # è¾“å…¥ AccessKey ID, AccessKey Secret, Endpoint
   
   # ä¸Šä¼ æ–‡ä»¶
   ./ossutil64 cp -r out/ oss://stockguru-web/ --update
   ```

4. **é…ç½®é™æ€ç½‘ç«™æ‰˜ç®¡**
   - åœ¨ OSS æ§åˆ¶å°ï¼Œé€‰æ‹© Bucket
   - åŸºç¡€è®¾ç½® -> é™æ€é¡µé¢
   - é»˜è®¤é¦–é¡µ: index.html
   - é»˜è®¤ 404 é¡µ: 404.html

### 2.2 éƒ¨ç½²åç«¯åˆ°å‡½æ•°è®¡ç®—

1. **åˆ›å»ºå‡½æ•°**
   - è®¿é—® https://fc.console.aliyun.com
   - åˆ›å»ºæœåŠ¡: `stockguru-backend`
   - åˆ›å»ºå‡½æ•°: HTTP å‡½æ•°
   - è¿è¡Œç¯å¢ƒ: Python 3.10

2. **ä¸Šä¼ ä»£ç **
   ```bash
   cd stockguru-web/backend
   
   # æ‰“åŒ…ä»£ç 
   zip -r function.zip app/ requirements.txt
   
   # é€šè¿‡æ§åˆ¶å°ä¸Šä¼  function.zip
   ```

3. **é…ç½®ç¯å¢ƒå˜é‡**
   - åœ¨å‡½æ•°é…ç½®ä¸­æ·»åŠ ç¯å¢ƒå˜é‡
   - SUPABASE_URL
   - SUPABASE_KEY

4. **é…ç½®è§¦å‘å™¨**
   - ç±»å‹: HTTP è§¦å‘å™¨
   - è·¯å¾„: /
   - æ–¹æ³•: ANY

---

## æ–¹æ¡ˆ3: å®¹å™¨æœåŠ¡ ACK éƒ¨ç½²

### 3.1 åˆ›å»º Kubernetes é›†ç¾¤

1. **è®¿é—®å®¹å™¨æœåŠ¡æ§åˆ¶å°**
   - https://cs.console.aliyun.com

2. **åˆ›å»ºæ‰˜ç®¡ç‰ˆé›†ç¾¤**
   - é›†ç¾¤åç§°: stockguru-cluster
   - åœ°åŸŸ: åä¸œ2ï¼ˆä¸Šæµ·ï¼‰
   - èŠ‚ç‚¹è§„æ ¼: 2æ ¸4G
   - èŠ‚ç‚¹æ•°é‡: 2

### 3.2 å‡†å¤‡ Docker é•œåƒ

```bash
# æ„å»ºåç«¯é•œåƒ
cd stockguru-web/backend
docker build -t stockguru-backend:latest .

# æ„å»ºå‰ç«¯é•œåƒ
cd ../../frontend
docker build -t stockguru-frontend:latest .

# æ¨é€åˆ°é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡
# 1. ç™»å½• https://cr.console.aliyun.com
# 2. åˆ›å»ºå‘½åç©ºé—´: stockguru
# 3. åˆ›å»ºé•œåƒä»“åº“

# ç™»å½•é•œåƒä»“åº“
docker login --username=your-username registry.cn-shanghai.aliyuncs.com

# æ‰“æ ‡ç­¾
docker tag stockguru-backend:latest registry.cn-shanghai.aliyuncs.com/stockguru/backend:latest
docker tag stockguru-frontend:latest registry.cn-shanghai.aliyuncs.com/stockguru/frontend:latest

# æ¨é€
docker push registry.cn-shanghai.aliyuncs.com/stockguru/backend:latest
docker push registry.cn-shanghai.aliyuncs.com/stockguru/frontend:latest
```

### 3.3 éƒ¨ç½²åˆ° Kubernetes

åˆ›å»º `k8s-deployment.yaml`:

```yaml
apiVersion: v1
kind: Namespace
metadata:
  name: stockguru

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: backend
  namespace: stockguru
spec:
  replicas: 2
  selector:
    matchLabels:
      app: backend
  template:
    metadata:
      labels:
        app: backend
    spec:
      containers:
      - name: backend
        image: registry.cn-shanghai.aliyuncs.com/stockguru/backend:latest
        ports:
        - containerPort: 8000
        env:
        - name: SUPABASE_URL
          value: "your-url"
        - name: SUPABASE_KEY
          value: "your-key"

---
apiVersion: v1
kind: Service
metadata:
  name: backend-service
  namespace: stockguru
spec:
  type: LoadBalancer
  ports:
  - port: 80
    targetPort: 8000
  selector:
    app: backend

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: frontend
  namespace: stockguru
spec:
  replicas: 2
  selector:
    matchLabels:
      app: frontend
  template:
    metadata:
      labels:
        app: frontend
    spec:
      containers:
      - name: frontend
        image: registry.cn-shanghai.aliyuncs.com/stockguru/frontend:latest
        ports:
        - containerPort: 3000
        env:
        - name: NEXT_PUBLIC_API_URL
          value: "http://backend-service"

---
apiVersion: v1
kind: Service
metadata:
  name: frontend-service
  namespace: stockguru
spec:
  type: LoadBalancer
  ports:
  - port: 80
    targetPort: 3000
  selector:
    app: frontend
```

éƒ¨ç½²ï¼š
```bash
# é…ç½® kubectl
# åœ¨ ACK æ§åˆ¶å°è·å– kubeconfig

# åº”ç”¨é…ç½®
kubectl apply -f k8s-deployment.yaml

# æŸ¥çœ‹çŠ¶æ€
kubectl get pods -n stockguru
kubectl get services -n stockguru

# æŸ¥çœ‹æ—¥å¿—
kubectl logs -f deployment/backend -n stockguru
kubectl logs -f deployment/frontend -n stockguru
```

---

## åŸŸåå’Œ SSL é…ç½®

### 1. åŸŸåè§£æ

1. **è´­ä¹°åŸŸå**
   - è®¿é—® https://wanwang.aliyun.com
   - è´­ä¹°åŸŸåï¼ˆå¦‚ stockguru.comï¼‰

2. **æ·»åŠ è§£æè®°å½•**
   - è®¿é—® https://dns.console.aliyun.com
   - æ·»åŠ  A è®°å½•:
     - `@` -> æœåŠ¡å™¨IPï¼ˆä¸»åŸŸåï¼‰
     - `www` -> æœåŠ¡å™¨IPï¼ˆwwwå­åŸŸåï¼‰
     - `api` -> æœåŠ¡å™¨IPï¼ˆAPIå­åŸŸåï¼‰

### 2. é…ç½® SSL è¯ä¹¦

**æ–¹æ³•1: ä½¿ç”¨ Let's Encryptï¼ˆå…è´¹ï¼‰**

```bash
# å®‰è£… Certbot
sudo apt install -y certbot python3-certbot-nginx

# è·å–è¯ä¹¦
sudo certbot --nginx -d your-domain.com -d www.your-domain.com -d api.your-domain.com

# è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run

# è®¾ç½®å®šæ—¶ä»»åŠ¡
sudo crontab -e
# æ·»åŠ : 0 3 * * * certbot renew --quiet
```

**æ–¹æ³•2: ä½¿ç”¨é˜¿é‡Œäº‘ SSL è¯ä¹¦**

1. è®¿é—® https://yundun.console.aliyun.com/?p=cas
2. è´­ä¹°å…è´¹è¯ä¹¦ï¼ˆ20ä¸ª/å¹´ï¼‰
3. ç”³è¯·è¯ä¹¦å¹¶ç»‘å®šåŸŸå
4. ä¸‹è½½è¯ä¹¦ï¼ˆé€‰æ‹© Nginx æ ¼å¼ï¼‰
5. ä¸Šä¼ åˆ°æœåŠ¡å™¨å¹¶é…ç½® Nginx

```bash
# åˆ›å»ºè¯ä¹¦ç›®å½•
sudo mkdir -p /etc/nginx/ssl

# ä¸Šä¼ è¯ä¹¦æ–‡ä»¶
sudo cp your-domain.com.pem /etc/nginx/ssl/
sudo cp your-domain.com.key /etc/nginx/ssl/

# ä¿®æ”¹ Nginx é…ç½®
sudo nano /etc/nginx/sites-available/stockguru
```

æ›´æ–°é…ç½®ï¼š
```nginx
server {
    listen 443 ssl http2;
    server_name your-domain.com www.your-domain.com;

    ssl_certificate /etc/nginx/ssl/your-domain.com.pem;
    ssl_certificate_key /etc/nginx/ssl/your-domain.com.key;
    
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}

# HTTP é‡å®šå‘åˆ° HTTPS
server {
    listen 80;
    server_name your-domain.com www.your-domain.com;
    return 301 https://$server_name$request_uri;
}
```

```bash
# é‡å¯ Nginx
sudo systemctl restart nginx
```

---

## ç›‘æ§å’Œè¿ç»´

### 1. æ—¥å¿—ç®¡ç†

```bash
# åç«¯æ—¥å¿—
sudo journalctl -u stockguru-backend -f

# å‰ç«¯æ—¥å¿—
pm2 logs stockguru-frontend

# Nginx æ—¥å¿—
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log
```

### 2. æ€§èƒ½ç›‘æ§

**ä½¿ç”¨é˜¿é‡Œäº‘äº‘ç›‘æ§**

1. è®¿é—® https://cloudmonitor.console.aliyun.com
2. æ·»åŠ  ECS å®ä¾‹ç›‘æ§
3. é…ç½®å‘Šè­¦è§„åˆ™:
   - CPU ä½¿ç”¨ç‡ > 80%
   - å†…å­˜ä½¿ç”¨ç‡ > 80%
   - ç£ç›˜ä½¿ç”¨ç‡ > 80%

**ä½¿ç”¨ PM2 ç›‘æ§**

```bash
# æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€
pm2 status

# å®æ—¶ç›‘æ§
pm2 monit

# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
pm2 show stockguru-frontend
```

### 3. è‡ªåŠ¨å¤‡ä»½

åˆ›å»ºå¤‡ä»½è„šæœ¬ `~/backup.sh`:

```bash
#!/bin/bash

# é…ç½®
BACKUP_DIR="/home/stockguru/backups"
DATE=$(date +%Y%m%d_%H%M%S)
PROJECT_DIR="/home/stockguru/apps/StockGuru"

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# å¤‡ä»½ä»£ç 
cd $PROJECT_DIR
git pull origin main
tar -czf $BACKUP_DIR/stockguru_$DATE.tar.gz .

# ä¿ç•™æœ€è¿‘7å¤©çš„å¤‡ä»½
find $BACKUP_DIR -name "stockguru_*.tar.gz" -mtime +7 -delete

echo "Backup completed: stockguru_$DATE.tar.gz"
```

```bash
# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x ~/backup.sh

# è®¾ç½®å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å¤©å‡Œæ™¨3ç‚¹ï¼‰
crontab -e
# æ·»åŠ : 0 3 * * * /home/stockguru/backup.sh
```

### 4. æ›´æ–°éƒ¨ç½²

```bash
# åˆ›å»ºæ›´æ–°è„šæœ¬ ~/update.sh
#!/bin/bash

cd ~/apps/StockGuru

# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# æ›´æ–°åç«¯
cd stockguru-web/backend
source venv/bin/activate
pip install -r requirements.txt
sudo systemctl restart stockguru-backend

# æ›´æ–°å‰ç«¯
cd ../../frontend
npm install
npm run build
pm2 restart stockguru-frontend

echo "Update completed!"
```

```bash
# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x ~/update.sh

# æ‰§è¡Œæ›´æ–°
~/update.sh
```

---

## æˆæœ¬ä¼°ç®—

### ECS æ–¹æ¡ˆï¼ˆæ¨èï¼‰

| é¡¹ç›® | é…ç½® | è´¹ç”¨ |
|------|------|------|
| ECS å®ä¾‹ | 1æ ¸4G | Â¥100/æœˆ |
| å¸¦å®½ | 5Mbps | Â¥30/æœˆ |
| äº‘ç›˜ | 40GB | Â¥10/æœˆ |
| åŸŸå | .com | Â¥60/å¹´ |
| SSL è¯ä¹¦ | å…è´¹ | Â¥0 |
| **æ€»è®¡** | | **Â¥140/æœˆ** |

### å‡½æ•°è®¡ç®—æ–¹æ¡ˆ

| é¡¹ç›® | é…ç½® | è´¹ç”¨ |
|------|------|------|
| OSS å­˜å‚¨ | 10GB | Â¥2/æœˆ |
| OSS æµé‡ | 10GB/æœˆ | Â¥5/æœˆ |
| å‡½æ•°è®¡ç®— | 100ä¸‡æ¬¡è°ƒç”¨ | Â¥10/æœˆ |
| åŸŸå | .com | Â¥60/å¹´ |
| **æ€»è®¡** | | **Â¥17/æœˆ** |

---

## æ•…éšœæ’æŸ¥

### 1. æœåŠ¡æ— æ³•è®¿é—®

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status stockguru-backend
pm2 status

# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tlnp | grep :8000
sudo netstat -tlnp | grep :3000

# æ£€æŸ¥é˜²ç«å¢™
sudo ufw status

# æ£€æŸ¥ Nginx
sudo nginx -t
sudo systemctl status nginx
```

### 2. å†…å­˜ä¸è¶³

```bash
# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
free -h

# åˆ›å»º Swap æ–‡ä»¶
sudo fallocate -l 2G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile

# æ°¸ä¹…ç”Ÿæ•ˆ
echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab
```

### 3. ç£ç›˜ç©ºé—´ä¸è¶³

```bash
# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
df -h

# æ¸…ç†æ—¥å¿—
sudo journalctl --vacuum-time=7d
pm2 flush

# æ¸…ç† npm ç¼“å­˜
npm cache clean --force

# æ¸…ç† pip ç¼“å­˜
pip cache purge
```

---

## å®‰å…¨åŠ å›º

### 1. SSH å®‰å…¨

```bash
# ä¿®æ”¹ SSH é…ç½®
sudo nano /etc/ssh/sshd_config

# ç¦ç”¨å¯†ç ç™»å½•ï¼Œåªå…è®¸å¯†é’¥ç™»å½•
PasswordAuthentication no
PubkeyAuthentication yes

# ç¦ç”¨ root ç™»å½•
PermitRootLogin no

# é‡å¯ SSH
sudo systemctl restart sshd
```

### 2. å®‰è£… Fail2Ban

```bash
# å®‰è£…
sudo apt install -y fail2ban

# é…ç½®
sudo nano /etc/fail2ban/jail.local
```

å†…å®¹ï¼š
```ini
[DEFAULT]
bantime = 3600
findtime = 600
maxretry = 5

[sshd]
enabled = true
```

```bash
# å¯åŠ¨
sudo systemctl start fail2ban
sudo systemctl enable fail2ban
```

### 3. å®šæœŸæ›´æ–°

```bash
# åˆ›å»ºæ›´æ–°è„šæœ¬
sudo nano /usr/local/bin/system-update.sh
```

å†…å®¹ï¼š
```bash
#!/bin/bash
apt update
apt upgrade -y
apt autoremove -y
```

```bash
# æ·»åŠ æ‰§è¡Œæƒé™
sudo chmod +x /usr/local/bin/system-update.sh

# å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å‘¨æ—¥å‡Œæ™¨4ç‚¹ï¼‰
sudo crontab -e
# æ·»åŠ : 0 4 * * 0 /usr/local/bin/system-update.sh
```

---

## ğŸ“š ç›¸å…³èµ„æº

- [é˜¿é‡Œäº‘ ECS æ–‡æ¡£](https://help.aliyun.com/product/25365.html)
- [é˜¿é‡Œäº‘å‡½æ•°è®¡ç®—æ–‡æ¡£](https://help.aliyun.com/product/50980.html)
- [é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡æ–‡æ¡£](https://help.aliyun.com/product/85222.html)
- [Nginx å®˜æ–¹æ–‡æ¡£](https://nginx.org/en/docs/)
- [PM2 å®˜æ–¹æ–‡æ¡£](https://pm2.keymetrics.io/docs/)

---

*æœ€åæ›´æ–°: 2025-10-15*
