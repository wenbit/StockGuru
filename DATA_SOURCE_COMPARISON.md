# ğŸ“Š æ•°æ®æºå¯¹æ¯”åˆ†ææŠ¥å‘Š

## ğŸ¯ ç›®æ ‡
åˆ†æ AKShare å’Œ AData æ˜¯å¦å¯ä»¥æ›¿ä»£/è¡¥å……å½“å‰çš„ baostockï¼Œæå‡åŒæ­¥å…¥åº“æ€§èƒ½

---

## ğŸ“‹ å½“å‰ä½¿ç”¨ï¼šbaostock

### ä¼˜åŠ¿
- âœ… **å…è´¹æ— é™åˆ¶**
- âœ… **ç¨³å®šæ€§é«˜**
- âœ… **æ•°æ®è´¨é‡å¥½**
- âœ… **æ— éœ€API Key**

### åŠ£åŠ¿
- âŒ **ä¸æ”¯æŒå¤šçº¿ç¨‹**ï¼ˆä¸»è¦ç“¶é¢ˆï¼‰
- âŒ **ä¸²è¡Œè°ƒç”¨æ…¢**ï¼ˆå 81%æ—¶é—´ï¼‰
- âŒ **å•æ—¥åŒæ­¥éœ€ 12-15 åˆ†é’Ÿ**

### å½“å‰æ€§èƒ½
```
å•æ—¥åŒæ­¥ (5158åªè‚¡ç¥¨):
- baostock API è°ƒç”¨: ~12åˆ†é’Ÿ (81%)
- æ•°æ®å¤„ç†: ~1.5åˆ†é’Ÿ (10%)
- æ•°æ®åº“æ’å…¥: ~1.3åˆ†é’Ÿ (9%)
æ€»è®¡: ~15åˆ†é’Ÿ
```

---

## ğŸ†š æ•°æ®æºå¯¹æ¯”

### 1. AKShare â­â­â­â­

#### åŸºæœ¬ä¿¡æ¯
- **é¡¹ç›®**: https://github.com/akfamily/akshare
- **Star**: 10k+
- **ç»´æŠ¤**: æ´»è·ƒ
- **æ•°æ®æº**: ä¸œæ–¹è´¢å¯Œã€æ–°æµªè´¢ç»ç­‰å¤šä¸ªå…¬å¼€æ¥å£

#### æ ¸å¿ƒç‰¹ç‚¹
```python
import akshare as ak

# è·å–å•åªè‚¡ç¥¨å†å²æ•°æ®
df = ak.stock_zh_a_hist(
    symbol="000001", 
    period="daily",
    start_date="20170301", 
    end_date='20231022',
    adjust=""
)
```

#### ä¼˜åŠ¿
- âœ… **æ¥å£ä¸°å¯Œ**ï¼šè¦†ç›–è‚¡ç¥¨ã€åŸºé‡‘ã€æœŸè´§ç­‰
- âœ… **æ•°æ®æºå¤šæ ·**ï¼šä¸œæ–¹è´¢å¯Œã€æ–°æµªã€è…¾è®¯ç­‰
- âœ… **æ›´æ–°åŠæ—¶**ï¼šæ•°æ®æ›´æ–°å¿«
- âœ… **æ–‡æ¡£å®Œå–„**ï¼šæœ‰è¯¦ç»†æ–‡æ¡£å’Œç¤ºä¾‹
- âœ… **æ”¯æŒå¤šç§æ•°æ®**ï¼šå®æ—¶è¡Œæƒ…ã€è´¢åŠ¡æ•°æ®ã€æ¦‚å¿µæ¿å—ç­‰

#### åŠ£åŠ¿
- âš ï¸ **ä¾èµ–å…¬å¼€æ¥å£**ï¼šå¯èƒ½è¢«é™æµ
- âš ï¸ **ç¨³å®šæ€§ä¸€èˆ¬**ï¼šæ¥å£å¯èƒ½å¤±æ•ˆ
- âš ï¸ **æ— å®˜æ–¹æ”¯æŒ**ï¼šçˆ¬è™«æ€§è´¨
- âš ï¸ **å¹¶å‘é™åˆ¶**ï¼šè¿‡å¿«è¯·æ±‚å¯èƒ½è¢«å°IP

#### æ€§èƒ½è¯„ä¼°
- **å•è‚¡æŸ¥è¯¢**: 100-300ms
- **æ‰¹é‡æŸ¥è¯¢**: ä¸æ”¯æŒçœŸæ­£çš„æ‰¹é‡
- **å¹¶å‘èƒ½åŠ›**: æœ‰é™ï¼ˆéœ€è¦æ§åˆ¶é¢‘ç‡ï¼‰
- **é¢„ä¼°æå‡**: **2-3å€**ï¼ˆé€šè¿‡å¼‚æ­¥å¹¶å‘ï¼‰

---

### 2. AData â­â­â­â­â­ æ¨è

#### åŸºæœ¬ä¿¡æ¯
- **é¡¹ç›®**: https://github.com/1nchaos/adata
- **Star**: 1k+
- **ç»´æŠ¤**: æ´»è·ƒ
- **æ•°æ®æº**: å¤šæ•°æ®æºèåˆï¼ˆä¸œæ–¹è´¢å¯Œã€åŒèŠ±é¡ºã€ç™¾åº¦è‚¡å¸‚é€šç­‰ï¼‰

#### æ ¸å¿ƒç‰¹ç‚¹
```python
import adata

# è·å–æ‰€æœ‰è‚¡ç¥¨ä»£ç 
codes_df = adata.stock.info.all_code()

# è·å–å•åªè‚¡ç¥¨è¡Œæƒ…
market_df = adata.stock.market.get_market(
    stock_code='000001',
    k_type=1,  # æ—¥K
    start_date='2021-01-01'
)
```

#### ä¼˜åŠ¿
- âœ… **å¤šæ•°æ®æºèåˆ**ï¼šè‡ªåŠ¨åˆ‡æ¢æ•°æ®æº
- âœ… **é«˜å¯ç”¨æ€§**ï¼šåŠ¨æ€è®¾ç½®ä»£ç†
- âœ… **ä¸“æ³¨Aè‚¡**ï¼šé’ˆå¯¹Aè‚¡ä¼˜åŒ–
- âœ… **æ¥å£ç®€æ´**ï¼šæ˜“äºä½¿ç”¨
- âœ… **æ”¯æŒä»£ç†**ï¼šå†…ç½®ä»£ç†æ± æ”¯æŒ
- âœ… **æ•°æ®å®Œæ•´**ï¼šåŒ…å«æ¦‚å¿µã€æ¿å—ã€è´¢åŠ¡ç­‰

#### åŠ£åŠ¿
- âš ï¸ **Starè¾ƒå°‘**ï¼šç›¸å¯¹å°ä¼—
- âš ï¸ **ä¾èµ–å…¬å¼€æ¥å£**ï¼šå¯èƒ½è¢«é™æµ
- âš ï¸ **éœ€è¦ä»£ç†**ï¼šé«˜é¢‘è¯·æ±‚éœ€è¦ä»£ç†æ± 

#### æ€§èƒ½è¯„ä¼°
- **å•è‚¡æŸ¥è¯¢**: 100-200ms
- **æ‰¹é‡æŸ¥è¯¢**: ä¸æ”¯æŒçœŸæ­£çš„æ‰¹é‡
- **å¹¶å‘èƒ½åŠ›**: ä¸­ç­‰ï¼ˆæ”¯æŒä»£ç†æ± ï¼‰
- **é¢„ä¼°æå‡**: **3-5å€**ï¼ˆé€šè¿‡å¼‚æ­¥+ä»£ç†æ± ï¼‰

---

## ğŸ¯ ä¼˜åŒ–æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: æ··åˆä½¿ç”¨ï¼ˆæ¨èï¼‰â­â­â­â­â­

**ç­–ç•¥**: baostock ä¸ºä¸»ï¼ŒAData/AKShare ä¸ºè¾…

#### å®æ–½æ–¹æ¡ˆ
```python
class HybridDataFetcher:
    """æ··åˆæ•°æ®è·å–å™¨"""
    
    def __init__(self):
        self.baostock = BaostockFetcher()
        self.adata = ADataFetcher()
        self.akshare = AKShareFetcher()
    
    async def fetch_daily_data(self, date_str):
        # 1. ä¼˜å…ˆä½¿ç”¨ ADataï¼ˆå¼‚æ­¥å¹¶å‘ï¼‰
        try:
            results = await self.adata.fetch_concurrent(
                stock_codes, 
                date_str,
                max_concurrent=20
            )
            if len(results) > 0.8 * len(stock_codes):
                return results
        except Exception as e:
            logger.warning(f"AData å¤±è´¥: {e}")
        
        # 2. å›é€€åˆ° baostockï¼ˆç¨³å®šä½†æ…¢ï¼‰
        return self.baostock.fetch_serial(stock_codes, date_str)
```

#### ä¼˜åŠ¿
- âœ… **æ€§èƒ½æå‡**: 3-5å€ï¼ˆæ­£å¸¸æƒ…å†µï¼‰
- âœ… **ç¨³å®šæ€§é«˜**: è‡ªåŠ¨å›é€€
- âœ… **æ•°æ®å®Œæ•´**: å¤šæºä¿éšœ

#### é¢„æœŸæ€§èƒ½
```
å•æ—¥åŒæ­¥ (5158åªè‚¡ç¥¨):
- æ­£å¸¸æƒ…å†µ: 3-5åˆ†é’Ÿ (ADataå¹¶å‘)
- å›é€€æƒ…å†µ: 12-15åˆ†é’Ÿ (baostock)
å¹³å‡: ~5åˆ†é’Ÿ (æå‡ 3å€)
```

---

### æ–¹æ¡ˆ 2: å®Œå…¨æ›¿æ¢ä¸º AData â­â­â­â­

**ç­–ç•¥**: ä½¿ç”¨ AData + ä»£ç†æ± 

#### å®æ–½æ–¹æ¡ˆ
```python
import adata
import asyncio

class ADataAsyncFetcher:
    """AData å¼‚æ­¥è·å–å™¨"""
    
    def __init__(self, proxy_pool):
        self.proxy_pool = proxy_pool
        adata.proxy(is_proxy=True, proxy_url=proxy_pool.get_url())
    
    async def fetch_batch(self, stock_codes, date_str):
        semaphore = asyncio.Semaphore(20)  # é™åˆ¶å¹¶å‘
        
        async def fetch_one(code):
            async with semaphore:
                return await self._fetch_single(code, date_str)
        
        tasks = [fetch_one(code) for code in stock_codes]
        return await asyncio.gather(*tasks)
```

#### ä¼˜åŠ¿
- âœ… **æ€§èƒ½æœ€ä¼˜**: 5-10å€æå‡
- âœ… **æ•°æ®æ›´æ–°å¿«**: å®æ—¶æ€§å¥½
- âœ… **åŠŸèƒ½ä¸°å¯Œ**: æ”¯æŒæ›´å¤šæ•°æ®

#### åŠ£åŠ¿
- âš ï¸ **éœ€è¦ä»£ç†æ± **: é¢å¤–æˆæœ¬
- âš ï¸ **ç¨³å®šæ€§é£é™©**: æ¥å£å¯èƒ½å¤±æ•ˆ
- âš ï¸ **ç»´æŠ¤æˆæœ¬**: éœ€è¦ç›‘æ§

#### é¢„æœŸæ€§èƒ½
```
å•æ—¥åŒæ­¥ (5158åªè‚¡ç¥¨):
- ç†æƒ³æƒ…å†µ: 2-3åˆ†é’Ÿ
- ä¸€èˆ¬æƒ…å†µ: 3-5åˆ†é’Ÿ
å¹³å‡: ~3åˆ†é’Ÿ (æå‡ 5å€)
```

---

### æ–¹æ¡ˆ 3: åˆ†æ—¶æ®µä½¿ç”¨ â­â­â­

**ç­–ç•¥**: å†å²æ•°æ®ç”¨ baostockï¼Œå®æ—¶æ•°æ®ç”¨ AData

#### å®æ–½æ–¹æ¡ˆ
```python
def sync_strategy(sync_date):
    today = date.today()
    
    if sync_date < today - timedelta(days=7):
        # å†å²æ•°æ®ï¼šä½¿ç”¨ baostockï¼ˆç¨³å®šï¼‰
        return baostock_fetcher.fetch(sync_date)
    else:
        # è¿‘æœŸæ•°æ®ï¼šä½¿ç”¨ ADataï¼ˆå¿«é€Ÿï¼‰
        return adata_fetcher.fetch(sync_date)
```

#### ä¼˜åŠ¿
- âœ… **å¹³è¡¡æ€§èƒ½å’Œç¨³å®šæ€§**
- âœ… **é™ä½é£é™©**
- âœ… **çµæ´»åˆ‡æ¢**

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”æ€»ç»“

| æ–¹æ¡ˆ | å•æ—¥åŒæ­¥ | æå‡å€æ•° | ç¨³å®šæ€§ | æˆæœ¬ | æ¨èåº¦ |
|------|---------|---------|--------|------|--------|
| **å½“å‰ (baostock)** | 12-15åˆ†é’Ÿ | 1x | â­â­â­â­â­ | $0 | â­â­â­ |
| **æ–¹æ¡ˆ1 (æ··åˆ)** | 3-5åˆ†é’Ÿ | 3-5x | â­â­â­â­ | $0 | â­â­â­â­â­ |
| **æ–¹æ¡ˆ2 (AData)** | 2-3åˆ†é’Ÿ | 5-10x | â­â­â­ | ä»£ç†æˆæœ¬ | â­â­â­â­ |
| **æ–¹æ¡ˆ3 (åˆ†æ—¶æ®µ)** | 5-8åˆ†é’Ÿ | 2-3x | â­â­â­â­ | $0 | â­â­â­â­ |

---

## ğŸš€ æ¨èå®æ–½æ–¹æ¡ˆ

### ç«‹å³å®æ–½ï¼šæ–¹æ¡ˆ1ï¼ˆæ··åˆä½¿ç”¨ï¼‰â­â­â­â­â­

#### ç†ç”±
1. **æ€§èƒ½æå‡æ˜æ˜¾**: 3-5å€
2. **é£é™©å¯æ§**: è‡ªåŠ¨å›é€€
3. **é›¶æˆæœ¬**: æ— éœ€ä»£ç†
4. **æ˜“äºå®æ–½**: ä»£ç æ”¹åŠ¨å°

#### å®æ–½æ­¥éª¤

**æ­¥éª¤ 1**: å®‰è£…ä¾èµ–
```bash
pip install adata akshare
```

**æ­¥éª¤ 2**: åˆ›å»ºæ··åˆè·å–å™¨
```python
# app/services/hybrid_data_fetcher.py
class HybridDataFetcher:
    def __init__(self):
        self.sources = {
            'adata': ADataFetcher(),
            'akshare': AKShareFetcher(),
            'baostock': BaostockFetcher()
        }
    
    async def fetch_with_fallback(self, stock_codes, date_str):
        # å°è¯•é¡ºåº: adata -> akshare -> baostock
        for source_name, fetcher in self.sources.items():
            try:
                results = await fetcher.fetch(stock_codes, date_str)
                if self._validate_results(results):
                    logger.info(f"ä½¿ç”¨ {source_name} è·å–æˆåŠŸ")
                    return results
            except Exception as e:
                logger.warning(f"{source_name} å¤±è´¥: {e}")
        
        raise Exception("æ‰€æœ‰æ•°æ®æºå‡å¤±è´¥")
```

**æ­¥éª¤ 3**: é›†æˆåˆ°ç°æœ‰æœåŠ¡
```python
# ä¿®æ”¹ daily_data_sync_service_neon.py
from app.services.hybrid_data_fetcher import HybridDataFetcher

class DailyDataSyncServiceNeon:
    def __init__(self):
        self.fetcher = HybridDataFetcher()
    
    async def sync_daily_data(self, sync_date):
        # ä½¿ç”¨æ··åˆè·å–å™¨
        results = await self.fetcher.fetch_with_fallback(
            stock_codes, 
            date_str
        )
```

---

## ğŸ“ˆ é¢„æœŸæ”¶ç›Š

### æ€§èƒ½æå‡
```
å½“å‰: 12-15åˆ†é’Ÿ/æ—¥
ä¼˜åŒ–å: 3-5åˆ†é’Ÿ/æ—¥
æå‡: 3-5å€

1å¹´æ•°æ®åŒæ­¥:
å½“å‰: 49å°æ—¶
ä¼˜åŒ–å: 10-16å°æ—¶
èŠ‚çœ: 33-39å°æ—¶
```

### ç´¯è®¡ä¼˜åŒ–æ•ˆæœ
```
Supabase: 57åˆ†é’Ÿ/æ—¥
    â†“ 57x
å½“å‰ä¼˜åŒ–: 1åˆ†é’Ÿ/æ—¥
    â†“ 3-5x (æ•°æ®è·å–ä¼˜åŒ–)
æœ€ç»ˆ: 12-20ç§’/æ—¥ âš¡âš¡âš¡
```

---

## âš ï¸ é£é™©è¯„ä¼°

### æ–¹æ¡ˆ1ï¼ˆæ··åˆï¼‰é£é™©
- **ä½é£é™©**: æœ‰ baostock å…œåº•
- **ä¸­æ”¶ç›Š**: 3-5å€æå‡
- **æ˜“ç»´æŠ¤**: ä»£ç ç®€å•

### æ–¹æ¡ˆ2ï¼ˆADataï¼‰é£é™©
- **ä¸­é£é™©**: ä¾èµ–å…¬å¼€æ¥å£
- **é«˜æ”¶ç›Š**: 5-10å€æå‡
- **éœ€ç»´æŠ¤**: ç›‘æ§æ¥å£çŠ¶æ€

---

## ğŸ¯ ç»“è®º

### æ¨èæ–¹æ¡ˆ
**æ–¹æ¡ˆ1ï¼ˆæ··åˆä½¿ç”¨ï¼‰** - æœ€ä½³æ€§ä»·æ¯”

### å®æ–½ä¼˜å…ˆçº§
1. âœ… **ç«‹å³**: å®æ–½æ–¹æ¡ˆ1ï¼ˆæ··åˆä½¿ç”¨ï¼‰
2. â³ **è§‚å¯Ÿ**: ç›‘æ§ç¨³å®šæ€§å’Œæ€§èƒ½
3. â³ **ä¼˜åŒ–**: æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ç­–ç•¥

### é¢„æœŸæ•ˆæœ
- **æ€§èƒ½**: æå‡ 3-5å€
- **ç¨³å®šæ€§**: ä¿æŒé«˜æ°´å¹³
- **æˆæœ¬**: $0
- **ç»´æŠ¤**: ä½

---

**åˆ†æå®Œæˆæ—¶é—´**: 2025-10-17 08:25  
**æ¨èæ–¹æ¡ˆ**: æ··åˆä½¿ç”¨ï¼ˆæ–¹æ¡ˆ1ï¼‰  
**é¢„æœŸæå‡**: 3-5å€  
**é£é™©ç­‰çº§**: ä½
