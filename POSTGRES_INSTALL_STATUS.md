# ğŸ“¦ PostgreSQL å®‰è£…çŠ¶æ€

## ğŸ”„ å½“å‰è¿›åº¦

**æ—¶é—´**: 2025-10-17 07:20  
**çŠ¶æ€**: ğŸ”„ æ­£åœ¨å®‰è£… Postgres.app...

---

## ğŸ“‹ å®‰è£…å°è¯•è®°å½•

### å°è¯• 1: brew install postgresql@15 âŒ
**çŠ¶æ€**: å¤±è´¥  
**åŸå› **: macOS 12 ç¼–è¯‘é”™è¯¯ï¼ˆkrb5 ä¾èµ–é—®é¢˜ï¼‰  
**é”™è¯¯**: `ld: library not found for -lcrypto`

### å°è¯• 2: Postgres.app âœ… è¿›è¡Œä¸­
**çŠ¶æ€**: ğŸ”„ æ­£åœ¨ä¸‹è½½...  
**æ–¹æ¡ˆ**: ä½¿ç”¨é¢„ç¼–è¯‘çš„ GUI åº”ç”¨  
**ä¼˜åŠ¿**: 
- æ— éœ€ç¼–è¯‘
- åŒ…å«å®Œæ•´çš„ PostgreSQL
- æ˜“äºç®¡ç†

---

## ğŸ¯ å¤‡é€‰æ–¹æ¡ˆ

å¦‚æœ Postgres.app å®‰è£…æ—¶é—´è¿‡é•¿ï¼Œå¯ä»¥è€ƒè™‘ï¼š

### æ–¹æ¡ˆ A: ä½¿ç”¨ Docker PostgreSQL â­â­â­â­â­ æ¨è

**æœ€å¿«é€Ÿçš„æ–¹æ¡ˆ**:
```bash
# 1. å¯åŠ¨ PostgreSQL å®¹å™¨
docker run -d \
  --name postgres-test \
  -e POSTGRES_PASSWORD=test123 \
  -e POSTGRES_DB=stockguru_test \
  -p 5432:5432 \
  postgres:15

# 2. ç­‰å¾…å¯åŠ¨ï¼ˆçº¦5ç§’ï¼‰
sleep 5

# 3. å¯¼å…¥è¡¨ç»“æ„
docker exec -i postgres-test psql -U postgres stockguru_test < stockguru-web/database/daily_stock_data_schema.sql

# 4. é…ç½®ç¯å¢ƒå˜é‡
export DATABASE_URL="postgresql://postgres:test123@localhost:5432/stockguru_test"

# 5. é‡å¯åç«¯
cd stockguru-web/backend
pkill -f uvicorn
uvicorn app.main:app --reload --port 8000 &
cd ../..

# 6. æµ‹è¯•
curl -X POST 'http://localhost:8000/api/v1/daily/sync' \
  -H 'Content-Type: application/json' \
  -d '{"sync_date": "2025-10-10"}'
```

**ä¼˜åŠ¿**:
- âœ… 2åˆ†é’Ÿå†…å®Œæˆ
- âœ… æ— ç¼–è¯‘é—®é¢˜
- âœ… æ˜“äºæ¸…ç†
- âœ… å®Œå…¨éš”ç¦»

---

### æ–¹æ¡ˆ B: ç»§ç»­ä½¿ç”¨ Neon + ä¼˜åŒ– â­â­â­â­

**å½“å‰æ–¹æ¡ˆå·²ç»å¾ˆå¥½**:
```python
# å·²æœ‰çš„ä¼˜åŒ–
- batch_size = 1500
- values.tolist()
- è‚¡ç¥¨åˆ—è¡¨ç¼“å­˜
- æ•°æ®åº“å‚æ•°ä¼˜åŒ–
- è‡ªåŠ¨å›é€€æœºåˆ¶

# æ€§èƒ½
- å•æ—¥: ~12åˆ†é’Ÿ
- 1å¹´: ~49å°æ—¶
- æå‡: 4.8å€ï¼ˆvs Supabaseï¼‰
```

**ä¼˜åŠ¿**:
- âœ… å·²ç»ç”Ÿäº§å°±ç»ª
- âœ… æ— éœ€é¢å¤–é…ç½®
- âœ… æ€§èƒ½å·²ç»å¾ˆå¥½
- âœ… ç¨³å®šå¯é 

---

## ğŸ’¡ æ¨èå†³ç­–

### å¦‚æœæƒ³å¿«é€Ÿæµ‹è¯• COPY å‘½ä»¤
**æ¨è**: ä½¿ç”¨ Docker PostgreSQLï¼ˆæ–¹æ¡ˆAï¼‰  
**åŸå› **: 2åˆ†é’Ÿå†…å®Œæˆï¼Œæ— ç¼–è¯‘é—®é¢˜

### å¦‚æœä¸æ€¥äºæµ‹è¯•
**æ¨è**: ç­‰å¾… Postgres.app å®‰è£…å®Œæˆ  
**åŸå› **: GUI ç®¡ç†æ›´æ–¹ä¾¿

### å¦‚æœåªæ˜¯æƒ³æå‡æ€§èƒ½
**æ¨è**: ç»§ç»­ä½¿ç”¨å½“å‰ Neon é…ç½®ï¼ˆæ–¹æ¡ˆBï¼‰  
**åŸå› **: å·²ç»æå‡ 4.8å€ï¼Œç”Ÿäº§å°±ç»ª

---

## ğŸš€ å¿«é€Ÿå†³ç­–è„šæœ¬

### é€‰é¡¹ 1: Dockerï¼ˆæœ€å¿«ï¼‰
```bash
./scripts/setup_docker_postgres.sh
```

### é€‰é¡¹ 2: ç­‰å¾… Postgres.app
```bash
# æ­£åœ¨å®‰è£…ä¸­...
# å®Œæˆåè¿è¡Œ: ./scripts/setup_local_postgres.sh
```

### é€‰é¡¹ 3: ä½¿ç”¨å½“å‰é…ç½®
```bash
# æ— éœ€æ“ä½œï¼Œå½“å‰é…ç½®å·²ä¼˜åŒ–
# æ€§èƒ½: 4.8å€æå‡
```

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”é¢„æµ‹

| ç¯å¢ƒ | å•æ—¥åŒæ­¥ | COPYç¨³å®šæ€§ | è®¾ç½®æ—¶é—´ |
|------|---------|-----------|---------|
| **Docker PostgreSQL** | **8-10åˆ†é’Ÿ** | â­â­â­â­â­ | **2åˆ†é’Ÿ** |
| Postgres.app | 8-10åˆ†é’Ÿ | â­â­â­â­â­ | 10-15åˆ†é’Ÿ |
| Neon + ä¼˜åŒ– | 12åˆ†é’Ÿ | â­â­â­â­ | 0åˆ†é’Ÿ |

---

**å½“å‰çŠ¶æ€**: ğŸ”„ Postgres.app ä¸‹è½½ä¸­...  
**å»ºè®®**: å¦‚æœæƒ³å¿«é€Ÿæµ‹è¯•ï¼Œä½¿ç”¨ Docker æ–¹æ¡ˆ  
**å¤‡æ³¨**: å½“å‰ Neon é…ç½®å·²ç»å¾ˆå¥½ï¼Œæ€§èƒ½æå‡ 4.8å€
