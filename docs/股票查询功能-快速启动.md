# ğŸš€ è‚¡ç¥¨æŸ¥è¯¢åŠŸèƒ½ - å¿«é€Ÿå¯åŠ¨æŒ‡å—

## ğŸ“‹ å‰ç½®å‡†å¤‡

### 1. ç¯å¢ƒè¦æ±‚
- Python 3.12+
- Node.js 18+
- Supabase è´¦å·

### 2. å®‰è£…ä¾èµ–

**åç«¯**:
```bash
cd stockguru-web/backend
pip install -r requirements.txt
```

**å‰ç«¯**:
```bash
cd frontend
npm install
```

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾ç½®

### 1. åœ¨ Supabase ä¸­æ‰§è¡Œ SQL

è®¿é—® Supabase Dashboard â†’ SQL Editorï¼Œä¾æ¬¡æ‰§è¡Œï¼š

```bash
# 1. æ‰§è¡ŒåŸºç¡€è¡¨ç»“æ„
stockguru-web/database/schema.sql

# 2. æ‰§è¡Œè‚¡ç¥¨æ•°æ®è¡¨ç»“æ„
stockguru-web/database/daily_stock_data_schema.sql
```

### 2. éªŒè¯è¡¨åˆ›å»º

ç¡®è®¤ä»¥ä¸‹è¡¨å·²åˆ›å»ºï¼š
- âœ… `daily_stock_data` - æ¯æ—¥è‚¡ç¥¨æ•°æ®è¡¨
- âœ… `sync_logs` - åŒæ­¥æ—¥å¿—è¡¨
- âœ… `tasks` - ä»»åŠ¡è¡¨ï¼ˆå·²å­˜åœ¨ï¼‰
- âœ… `results` - ç»“æœè¡¨ï¼ˆå·²å­˜åœ¨ï¼‰

---

## âš™ï¸ é…ç½®ç¯å¢ƒå˜é‡

### åç«¯é…ç½®

ç¼–è¾‘ `stockguru-web/backend/.env`:

```bash
SUPABASE_URL=your_supabase_url
SUPABASE_KEY=your_supabase_anon_key
```

### å‰ç«¯é…ç½®

ç¼–è¾‘ `frontend/.env.local`:

```bash
NEXT_PUBLIC_API_URL=http://localhost:8000
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
```

---

## ğŸš€ å¯åŠ¨æœåŠ¡

### 1. å¯åŠ¨åç«¯

```bash
cd stockguru-web/backend
uvicorn app.main:app --reload --port 8000
```

**éªŒè¯**:
- è®¿é—® http://localhost:8000/docs
- åº”è¯¥èƒ½çœ‹åˆ°æ–°å¢çš„ `/api/v1/daily` ç›¸å…³æ¥å£

### 2. å¯åŠ¨å‰ç«¯

```bash
cd frontend
npm run dev
```

**éªŒè¯**:
- è®¿é—® http://localhost:3000/query
- è®¿é—® http://localhost:3000/sync

---

## ğŸ“Š åˆå§‹åŒ–æ•°æ®

### æ–¹æ³•1: é€šè¿‡å‰ç«¯ç•Œé¢ï¼ˆæ¨èï¼‰

1. è®¿é—® http://localhost:3000/sync
2. ç‚¹å‡»"åŒæ­¥å†å²æ•°æ®"æŒ‰é’®
3. è¾“å…¥å¤©æ•°ï¼ˆå»ºè®® `90`ï¼‰
4. ç­‰å¾…åŒæ­¥å®Œæˆï¼ˆçº¦30-60åˆ†é’Ÿï¼‰

### æ–¹æ³•2: é€šè¿‡ API

```bash
curl -X POST "http://localhost:8000/api/v1/daily/sync" \
  -H "Content-Type: application/json" \
  -d '{"days": 90}'
```

### æ–¹æ³•3: é€šè¿‡ Python è„šæœ¬

åˆ›å»º `init_data.py`:

```python
import asyncio
from app.services.daily_data_sync_service import get_sync_service

async def main():
    sync_service = get_sync_service()
    result = await sync_service.sync_historical_data(days=90)
    print(f"åŒæ­¥å®Œæˆ: {result}")

if __name__ == "__main__":
    asyncio.run(main())
```

è¿è¡Œ:
```bash
cd stockguru-web/backend
python init_data.py
```

---

## âœ… åŠŸèƒ½æµ‹è¯•

### 1. æµ‹è¯•æŸ¥è¯¢åŠŸèƒ½

è®¿é—® http://localhost:3000/query

**æµ‹è¯•ç”¨ä¾‹1**: æŸ¥æ‰¾å¤§æ¶¨è‚¡ç¥¨
- å¼€å§‹æ—¥æœŸ: æœ€è¿‘30å¤©å‰
- ç»“æŸæ—¥æœŸ: æ˜¨å¤©
- æœ€å°æ¶¨è·Œå¹…: `5`
- ç‚¹å‡»"å¼€å§‹æŸ¥è¯¢"

**é¢„æœŸç»“æœ**: æ˜¾ç¤ºæ¶¨å¹…â‰¥5%çš„è‚¡ç¥¨åˆ—è¡¨

### 2. æµ‹è¯•åŒæ­¥åŠŸèƒ½

è®¿é—® http://localhost:3000/sync

**æµ‹è¯•ç”¨ä¾‹2**: æ‰‹åŠ¨åŒæ­¥ä»Šæ—¥æ•°æ®
- ç‚¹å‡»"åŒæ­¥ä»Šæ—¥æ•°æ®"
- æŸ¥çœ‹åŒæ­¥æ—¥å¿—

**é¢„æœŸç»“æœ**: 
- å¦‚æœæ˜¯äº¤æ˜“æ—¥ï¼šæ˜¾ç¤ºåŒæ­¥æˆåŠŸ
- å¦‚æœæ˜¯éäº¤æ˜“æ—¥ï¼šæ˜¾ç¤º"å·²è·³è¿‡"

### 3. æµ‹è¯• API

```bash
# è·å–æ•°æ®ç»Ÿè®¡
curl http://localhost:8000/api/v1/daily/stats

# æŸ¥è¯¢è‚¡ç¥¨æ•°æ®
curl -X POST "http://localhost:8000/api/v1/daily/query" \
  -H "Content-Type: application/json" \
  -d '{
    "start_date": "2025-09-16",
    "end_date": "2025-10-16",
    "change_pct_min": 5,
    "sort_by": "change_pct",
    "sort_order": "desc",
    "page": 1,
    "page_size": 20
  }'

# è·å–å•åªè‚¡ç¥¨å†å²
curl http://localhost:8000/api/v1/daily/stock/000001?limit=60
```

---

## ğŸ”§ å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1: åç«¯å¯åŠ¨å¤±è´¥

**é”™è¯¯**: `ImportError: No module named 'APScheduler'`

**è§£å†³**:
```bash
pip install APScheduler==3.10.4
```

### é—®é¢˜2: æ•°æ®åº“è¿æ¥å¤±è´¥

**é”™è¯¯**: `Supabase è¿æ¥å¤±è´¥`

**è§£å†³**:
1. æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„ `SUPABASE_URL` å’Œ `SUPABASE_KEY`
2. ç¡®è®¤ Supabase é¡¹ç›®çŠ¶æ€æ­£å¸¸
3. æ£€æŸ¥ç½‘ç»œè¿æ¥

### é—®é¢˜3: åŒæ­¥æ•°æ®å¤±è´¥

**é”™è¯¯**: `akshare æœªå®‰è£…`

**è§£å†³**:
```bash
pip install akshare
```

### é—®é¢˜4: å‰ç«¯é¡µé¢ç©ºç™½

**é”™è¯¯**: æ§åˆ¶å°æ˜¾ç¤º CORS é”™è¯¯

**è§£å†³**:
1. ç¡®è®¤åç«¯å·²å¯åŠ¨
2. æ£€æŸ¥ `NEXT_PUBLIC_API_URL` é…ç½®
3. ç¡®è®¤åç«¯ CORS é…ç½®æ­£ç¡®

### é—®é¢˜5: å®šæ—¶ä»»åŠ¡æœªå¯åŠ¨

**æ£€æŸ¥æ–¹æ³•**:
```bash
# æŸ¥çœ‹åç«¯æ—¥å¿—
# åº”è¯¥çœ‹åˆ°: "å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨å·²å¯åŠ¨"
```

**è§£å†³**:
1. ç¡®è®¤åç«¯æ­£å¸¸å¯åŠ¨
2. æ£€æŸ¥æ—¥å¿—ä¸­æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
3. æ‰‹åŠ¨è§¦å‘åŒæ­¥æµ‹è¯•

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. æ•°æ®åº“ç´¢å¼•

ç¡®ä¿ä»¥ä¸‹ç´¢å¼•å·²åˆ›å»ºï¼ˆå·²åœ¨ schema ä¸­å®šä¹‰ï¼‰:
- `idx_daily_stock_trade_date`
- `idx_daily_stock_code`
- `idx_daily_stock_change_pct`
- `idx_daily_stock_date_change`

### 2. æŸ¥è¯¢ä¼˜åŒ–

- ç¼©å°æ—¥æœŸèŒƒå›´
- ä½¿ç”¨æ¶¨è·Œå¹…ç­›é€‰
- åˆç†è®¾ç½®åˆ†é¡µå¤§å°

### 3. åŒæ­¥ä¼˜åŒ–

- é¦–æ¬¡åŒæ­¥é€‰æ‹©è¾ƒçŸ­æ—¶é—´èŒƒå›´ï¼ˆ30å¤©ï¼‰
- ä½¿ç”¨å¢é‡åŒæ­¥ï¼ˆæ¯æ—¥è‡ªåŠ¨ï¼‰
- é¿å…é«˜å³°æ—¶æ®µæ‰‹åŠ¨åŒæ­¥

---

## ğŸ¯ ä¸‹ä¸€æ­¥

### åŠŸèƒ½æ‰©å±•
1. æ·»åŠ æ•°æ®å¯¼å‡ºåŠŸèƒ½
2. é›†æˆ Kçº¿å›¾å±•ç¤º
3. æ·»åŠ æ›´å¤šç­›é€‰æ¡ä»¶
4. æ”¯æŒè‡ªå®šä¹‰æŒ‡æ ‡è®¡ç®—

### æ€§èƒ½ä¼˜åŒ–
1. æ·»åŠ  Redis ç¼“å­˜
2. ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢
3. å®ç°æ•°æ®é¢„åŠ è½½
4. æ·»åŠ  CDN åŠ é€Ÿ

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å®Œæ•´ä½¿ç”¨æŒ‡å—](./è‚¡ç¥¨æŸ¥è¯¢åŠŸèƒ½ä½¿ç”¨æŒ‡å—.md)
- [API æ–‡æ¡£](http://localhost:8000/docs)
- [é¡¹ç›® README](../README.md)

---

## ğŸ†˜ è·å–å¸®åŠ©

å¦‚é‡åˆ°é—®é¢˜ï¼š
1. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
2. æ£€æŸ¥ API æ–‡æ¡£
3. æäº¤ GitHub Issue
4. æŸ¥çœ‹å¸¸è§é—®é¢˜

---

**ç¥ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰
